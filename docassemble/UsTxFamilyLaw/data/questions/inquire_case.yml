---
include:
  - docassemble.AssemblyLine:assembly_line.yml
  - docassemble.AssemblyLine:al_package.yml
---
modules:
  - docassemble.UsTxFamilyLaw.functions
---
objects:
  - court_info: DAObject
  - case: DAObject
  - case.petitioner: ALIndividual
  - case.respondent: ALIndividual
  - case.client: ALIndividual
  - case.op: ALIndividual
  - case.oc: ALIndividual
  - case.child: ALPeopleList
  - case.attorney: ALIndividual
---
id: build case choices
sets:
  - case_choices
code: |
  case_choices = []
  cases = get_cases()
  for id in cases:
    the_case = cases[id]
    case_choices.append({the_case: case.client, 'help': f"{case.county} Cause #{case.id} - {case.petitioner} v. {case.respondent}"})
---
id: inquire case
question: |
  <i class="fa-solid fa-gavel" style="color: #74C0FC;"></i> Case Information
fields:
  - Create a new case?: new_case_flag
    datatype: yesno
  #- Select case: case
  #  datatype: object
  #  required: False
  #  choices: case_choices
  - Cause number: case.id
    show if: new_case_flag
  - Court type: court_type
    show if: new_case_flag
  - Court name: court_info.court
    show if: new_case_flag
  - State: case.us_state
    default: TX
    show if: new_case_flag
  - County: case.county
    show if: new_case_flag
    code: |
      us_counties("TX")
  - Is divorce?: case.is_dissolution
    datatype: yesno
    show if: new_case_flag
  - Our billing number: case.billing_number
    show if: new_case_flag
---
id: inquire attorney
sets:
  - case.attorney.name.first
  - case.attorney.gender
  - case.attorney.mailing_address.address
  - case.attorney.bar_number
  - case.attorney.firm_name
  - case.attorney.telephone_number
  - case.attorney.fax_number
  - case.attorney.email
question: |
  <i class="fa-solid fa-user-tie" style="color: #74C0FC;"></i> Attorney issuing the subpoena.
fields:
  - code: |
      case.attorney.name_fields() + case.attorney.gender_fields() + case.attorney.pronoun_fields() + case.attorney.mailing_address.address_fields()
  - Bar number: case.attorney.bar_number
  - Firm name: case.attorney.firm_name
  - Telephone: case.attorney.telephone_number
  - Fax: case.attorney.fax_number
  - Email: case.attorney.email
    datatype: email
---
id: case style
sets:
  - case.style
  - case_style_set
code: |
  case.style = ""
  if case.is_dissolution:
    case.style = "In the Matter of the Marriage of " + case.petitioner.name_full() + " and " + case.respondent.name_full()
  if case.child.number_gathered() > 0:
    if case.is_dissolution:
      case.style += " and "
    case.style += "In the interest of " + case.child.comma_and_list()
  case_style_set = True
---
id: inquire petitioner
question: |
  <i class="fa-solid fa-user-tie" style="color: #74C0FC;"></i> Who is the petitioner?
fields:
  - code: |
      case.petitioner.name_fields() + case.petitioner.gender_fields() + case.petitioner.pronoun_fields()
  - Birth date: case.petitioner.birthdate
    datatype: date
  - SSN (last 4): case.petitioner.ssn_last4
---
id: inquire respondent
question: |
  <i class="fa-solid fa-user-tie" style="color: #74C0FC;"></i> Who is the respondent?
fields:
  - code: |
      case.respondent.name_fields() + case.respondent.gender_fields() + case.respondent.pronoun_fields()
  - Birth date: case.respondent.birthdate
    datatype: date
  - SSN (last 4): case.respondent.ssn_last4
---
id: inquire opposing counsel
sets:
  - case.oc.name.first
question: |
  <i class="fa-solid fa-user-tie" style="color: #74C0FC;"></i> Who is your opposing counsel?
fields:
  - code: |
      case.oc.name_fields() + case.oc.gender_fields() + case.oc.pronoun_fields()
  - Email: case.oc.email
---
id: inquire client
sets: case.client
question: |
  <i class="fa-solid fa-people-arrows" style="color: #74C0FC;"></i> Please select our client from the following parties:
fields:
  - Client: case.client
    datatype: object
    choices: [case.petitioner, case.respondent]
---
id: set opposing party
code: |
  if case.client == case.petitioner:
    case.op = case.respondent
  else:
    case.op = case.petitioner
  op_set = True
---
id: save case to the database
sets:
  - case_saved
code: |
  save_case(case)
  case_saved = True
---
